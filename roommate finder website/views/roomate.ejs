<% layout("/layouts/boilerplates") %>
<body class="bg-gray-200 dark:bg-gray-900 relative">
    <!-- Background image and color overlay -->
    <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://www.example.com/path/to/your-background-image.jpg'); background-color: rgba(34, 49, 63, 0.7); mix-blend-mode: overlay;"></div>

    <!-- Main Profile Section with Right Margin -->
    <main class="relative z-10 flex flex-col items-center justify-center py-16 px-6 md:px-16 lg:px-24" style="margin: 2rem 10rem; width: 90%;">

        <!-- Profile Card -->
        <div class="my-8 w-full max-w-2xl bg-white bg-opacity-90 border border-gray-200 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-700 p-8 mb-12">
            <!-- Profile Image and Information -->
            <div class="flex flex-col items-center text-center">
                <img class="w-80 h-80 mb-4 rounded-full shadow-lg" src="/<%= user.image %>" alt="User profile image">

                <h2 class="text-2xl font-semibold text-gray-900 dark:text-white"><%= user.first_name %> <%= user.last_name %></h2>
                <p class="text-sm text-gray-500 dark:text-gray-400"><%= user.gender %> • <%= user.age %> • <%= user.state %></p>
            </div>
            
            <!-- Profile Actions -->
            <div class="flex justify-center space-x-2 mt-4">
                <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">New</span>
                <button class="px-4 py-1 text-sm font-medium text-blue-600 border border-blue-600 rounded-full hover:bg-blue-600 hover:text-gray-900 transition-all duration-300">Free to message</button>
                <button class="px-4 py-1 text-sm font-medium text-red-600 border border-red-600 rounded-full hover:bg-red-600 hover:text-gray-900 transition-all duration-300">Team up</button>
            </div>

            <!-- Location and Budget Information -->
            <div class="mt-6 text-center">
                <p class="text-gray-700 dark:text-gray-300"><strong>Looking in:</strong><%= user.city %>, <%= user.state %>, <%= user.pin %></p>
                <div class="flex flex-wrap justify-center mt-4">
                    <div class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md px-4 py-2 m-2">
                        <strong>Rent:</strong> ₹<%= user.budget %> per month
                    </div>
                   
                    <div class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md px-4 py-2 m-2">
                        <strong>Ready to move:</strong> Now
                    </div>
                    <div class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md px-4 py-2 m-2">
                        <strong>Interested in:</strong> Teaming-up
                    </div>
                </div>
            </div>

            <!-- Description Section -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Description</h3>
                <p class="text-gray-700 dark:text-gray-300 mt-2"><%= user.description %></p>
            </div>

            <!-- Verification Section -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white"><%= user.first_name %> <%= user.last_name %> Verifications</h3>
                <div class="flex items-center mt-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                    <svg class="w-6 h-6 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 9l4 4L18 3" />
                    </svg>
                    <p class="ml-3 text-gray-700 dark:text-gray-300"><%= user.phone %></p>
                    <p class="ml-auto text-gray-500 dark:text-gray-400">Verified</p>
                </div>
            </div>
        </div>

    

           <!-- Reviews Section -->
<div class="py-4 px-4 w-full h-auto max-w-2xl bg-white bg-opacity-90 border border-gray-200 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-700 p-10 mb-16 max-h-full">
    <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6">Reviews</h3>
  
    <div class="mt-6 space-y-8">
      <!-- Review by Aman Gupta with 5-star rating -->
      <div class="bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-md">
        <p class="text-lg font-medium text-gray-900 dark:text-white">Aman Gupta</p>
        <div class="flex items-center mt-1 text-3xl">
          <!-- Display 5 filled stars for a 5-star rating -->
          <span class="text-yellow-500">&#9733;</span> <!-- Filled star -->
          <span class="text-yellow-500">&#9733;</span> <!-- Filled star -->
          <span class="text-yellow-500">&#9733;</span> <!-- Filled star -->
          <span class="text-yellow-500">&#9733;</span> <!-- Filled star -->
          <span class="text-yellow-500">&#9733;</span> <!-- Filled star -->
        </div>
        <p class="text-gray-500 dark:text-gray-400 text-base mt-3">Good to see you</p>
      </div>
  
      <!-- Loop to Display User Reviews -->
        <% if (user.reviews && user.reviews.length > 0) { %>
        <% user.reviews.forEach(review => { %>
          <div class="bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-md">
            <p class="text-lg font-medium text-gray-900 dark:text-white"><%= review.username %></p>
            <div class="flex items-center mt-1 text-3xl">
              <!-- Display stars for rating -->
              <% for (let i = 1; i <= 5; i++) { %>
                <% if (i <= review.rating) { %>
                  <span class="text-yellow-500">&#9733;</span> <!-- Filled star -->
                <% } else { %>
                  <span class="text-gray-300">&#9734;</span> <!-- Empty star -->
                <% } %>
              <% } %>
            </div>
            <p class="text-gray-500 dark:text-gray-400 text-base mt-3"><%= review.comment %></p>
          </div>
        <% }); %>
      <% } else { %>
        <p class="text-gray-500 dark:text-gray-400 text-base">No reviews available.</p>
      <% } %>
    </div>
  </div>
  



                 <!-- Add a Review Form -->
                <div class="py-4 px-4  mt-8 w-full h-auto max-w-2xl bg-white bg-opacity-90 border border-gray-200 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-700 p-10 mb-16 max-h-full">
                 <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Leave a Review</h4>
                <form id="reviewForm" action="/submit/<%= user.id %>/review" method="POST" class="mt-6 space-y-4" novalidate>
                   <div class="flex space-x-2">
                       <span class="text-gray-600 dark:text-gray-400">Rating:</span>
                   <div class="star-rating flex">
                           <!-- Star Rating -->
                        <input type="hidden" name="rating" id="rating" value="">
                        <span class="star cursor-pointer text-gray-400 text-2xl" data-value="1">★</span>
                        <span class="star cursor-pointer text-gray-400 text-2xl" data-value="2">★</span>
                        <span class="star cursor-pointer text-gray-400 text-2xl" data-value="3">★</span>
                         <span class="star cursor-pointer text-gray-400 text-2xl" data-value="4">★</span>
                         <span class="star cursor-pointer text-gray-400 text-2xl" data-value="5">★</span>
                      </div>
                       </div>
                       <textarea id="comment" class="w-full p-4 border border-gray-300 rounded-lg dark:bg-gray-700 dark:text-white dark:border-gray-600" placeholder="Write your review here..." rows="4" required></textarea>
                       <button type="submit" class="px-6 py-2 text-lg font-medium text-white bg-blue-600 rounded-full hover:bg-blue-700 transition-all duration-300">Submit Review</button>
                 </form>
                   <div id="error-message" class="text-red-500 mt-2 hidden"></div>
                </div>

    
        <!-- Call to Action for Messaging -->
        <div class="h-auto my-4 w-full max-w-2xl bg-white bg-opacity-90 border border-gray-200 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-700 p-6 text-center">
            <div class="flex items-center justify-center">
                <img class="w-8 h-8 mr-3 rounded-full" src="/<%= user.image %>" alt="User profile image">
                <p class="text-gray-900 dark:text-white"><%= user.first_name %> <%= user.last_name %>  is online now</p>
            </div>
            <p class="mt-3 text-gray-500 dark:text-gray-400">You can't message <%= user.first_name %> <%= user.last_name %> .</p>
            <p class="mt-2 text-gray-700 dark:text-gray-300">To message<%= user.first_name %> <%= user.last_name %>  or view their phone number, you need to be a member. Joining and communicating is free.</p>
            <div class="flex justify-center mt-4 space-x-4">
                <a href="#" class="px-4 py-2 text-sm font-medium text-white bg-teal-500 rounded-full hover:bg-teal-600 transition-all duration-300">List your room</a>
                <a href="#" class="px-4 py-2 text-sm font-medium text-teal-500 border border-teal-500 rounded-full hover:bg-teal-500 hover:text-gray-900 transition-all duration-300">Find a room</a>
            </div> 
            <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">Already a member? <a href="#" class="text-teal-500 hover:underline">Login now</a></p>



        
    </main>
    <script>
    // Select the review form and rating elements
    const reviewForm = document.getElementById('reviewForm');
    const ratingInput = document.getElementById('rating');
    const commentInput = document.getElementById('comment');
    const errorMessage = document.getElementById('error-message');

    // Handle star rating selection
    const stars = document.querySelectorAll('.star');
    stars.forEach(star => {
        star.addEventListener('click', function() {
            const value = this.getAttribute('data-value');
            ratingInput.value = value; // Set rating value in the hidden input
            updateStarStyles(value);  // Update star styling to show which one was selected
        });
    });

    // Function to update the star styles based on selected rating
    function updateStarStyles(selectedRating) {
        stars.forEach(star => {
            if (parseInt(star.getAttribute('data-value')) <= selectedRating) {
                star.classList.add('text-yellow-500');
                star.classList.remove('text-gray-400');
            } else {
                star.classList.add('text-gray-400');
                star.classList.remove('text-yellow-500');
            }
        });
    }

    // Form validation before submission
    reviewForm.addEventListener('submit', function(event) {
        let valid = true;
        errorMessage.classList.add('hidden'); // Hide error message by default

        // Check if rating is selected
        if (!ratingInput.value) {
            valid = false;
            errorMessage.textContent = 'Please select a rating (1-5).';
        }

        // Check if comment is provided
        if (!commentInput.value.trim()) {
            valid = false;
            errorMessage.textContent = errorMessage.textContent 
                ? errorMessage.textContent + ' Please write a comment.'
                : 'Please write a comment.';
                commentInput.style.borderColor = 'red';
        }
        else {
    // Reset the border color if valid
    commentInput.style.borderColor = '';
}

        // If invalid, prevent form submission and show error
        if (!valid) {
            event.preventDefault(); // Prevent form submission
            errorMessage.classList.remove('hidden');
        }
    });
    </script>
</body>
